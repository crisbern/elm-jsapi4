{"version":3,"sources":["../src/main.js"],"names":["info","appId","popup","cardContainer","document","getElementById","left","collapse","offsetWidth","easing","onProgress","values","style","a","right","onComplete","display","from","to","expand","id","registerOAuthInfos","btnBack","createElement","classList","add","innerText","map","basemap","view","webmap","addEventListener","removeAll","getCredential","portalUrl","then","results","node","app","Elm","Cards","embed","x","selected","ports","cards","send","items","selectCard","subscribe","foundCard","find","container","ui","type","portalItem","load","goTo","initialViewProperties","viewpoint","fromPortalItem","layer","fullExtent","otherwise","error","console","log"],"mappings":"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","file":"main.js","sourcesContent":["import OAuthInfo from \"esri/identity/OAuthInfo\";\nimport esriKernel from \"esri/kernel\";\n\nimport EsriMap from \"esri/Map\";\nimport WebMap from \"esri/WebMap\";\nimport MapView from \"esri/views/MapView\";\nimport Layer from \"esri/layers/Layer\";\n\nimport { loadPortal, queryPortalItems } from \"./portalResources.service\";\nimport { animate, inSine } from \"./animate\";\n\nconst info = new OAuthInfo({\n  appId: \"UYi0AqKPKbDn26bo\",\n  popup: false\n});\n\nconst cardContainer = document.getElementById(\"card-container\");\n\nlet left = 0;\nfunction collapse() {\n  left = cardContainer.offsetWidth;\n  animate({\n    easing: inSine,\n    onProgress(values) {\n      cardContainer.style.left = values.a + \"px\";\n      cardContainer.style.right = (-values.a) + \"px\";\n    },\n    onComplete() {\n      cardContainer.style.display = \"none\";\n    },\n    from: { a: 0 },\n    to: { a: left }\n  });\n}\n\nfunction expand() {\n  cardContainer.style.display = \"block\";\n  animate({\n    easing: inSine,\n    onProgress(values) {\n      cardContainer.style.left = values.a + \"px\";\n      cardContainer.style.right = (-values.a) + \"px\";\n    },\n    onComplete() {},\n    from: { a: left },\n    to: { a: 0 }\n  });\n}\n\nesriKernel.id.registerOAuthInfos([info]);\n\nconst btnBack = document.createElement(\"div\");\nbtnBack.classList.add(\"btn\");\nbtnBack.innerText = \"Back\";\nconst map = new EsriMap({ basemap: \"dark-gray\" });\nlet view;\nlet webmap;\n\nbtnBack.addEventListener(\"click\", () => {\n  if (map) {\n    map.removeAll();\n  }\n  if (view) {\n    view.map = null;\n  }\n  expand();\n});\n\nesriKernel.id.getCredential(info.portalUrl)\n  .then(loadPortal)\n  .then(queryPortalItems)\n  .then(({ results }) => {\n    // load Elm bits here\n    const node = document.getElementById(\"portalDiv\");\n    const app = Elm.Cards.embed(node);\n    results.map(x => {\n      x.selected = false;\n    });\n    app.ports.cards.send({ items: results });\n    app.ports.selectCard.subscribe(({ id }) => {\n      const foundCard = results.find(x => x.id === id);\n      if (!view) {\n        view = new MapView({\n          map,\n          container: \"viewDiv\"\n        });\n        view.then(_ => view.ui.add(btnBack, \"bottom-left\"));\n      }\n\n      if (foundCard.type === \"Web Map\") {\n        webmap = new WebMap({\n          portalItem: {\n            id: id\n          }\n        });\n        webmap.load().then(_ => {\n          view.map = webmap;\n          view.goTo(webmap.initialViewProperties.viewpoint);\n        });\n      }\n      else {\n        view.map = map;\n        Layer.fromPortalItem({ portalItem: { id } }).then(layer => {\n          map.add(layer);\n          layer.then(_ => view.goTo(layer.fullExtent));\n        });\n      }\n      collapse();\n    });\n  })\n  .otherwise((error) => console.log(\"Error logging in\", error));"]}